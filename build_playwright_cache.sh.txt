#!/usr/bin/env bash
set -e

# 1. Install Python dependencies
pip install -r requirements.txt

# 2. Download Playwright browser binaries
python -m playwright install --with-deps chromium

# 3. Cache logic
if [[ ! -d "$PLAYWRIGHT_BROWSERS_PATH" ]]; then
  echo "Initializing Playwright cache..."
  cp -R "$XDG_CACHE_HOME/playwright/" "$PLAYWRIGHT_BROWSERS_PATH"
else
  echo "Restoring Playwright cache for future builds..."
  cp -R "$PLAYWRIGHT_BROWSERS_PATH" "$XDG_CACHE_HOME"
fi
